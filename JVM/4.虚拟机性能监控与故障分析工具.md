# 虚拟机性能监控与故障分析工具

## 1、JDK的命令行工具

主要是指放置在jdk的bin目录下面的可执行文件。

### 1.1 jps：虚拟机进程状况工具

命令格式：

    jps [options] [hostid]

jps常用的选项

    -p  只输出LVMID，省略主类的名称
    -m  输出虚拟机进程启动时传递给主类main（）函数的参数
    -l  输出主类的全名，如果进程执行的是jar包，输出jar路径
    -v  输出虚拟机进程启动时jvm参数

### 1.2 jstat：虚拟机统计信息监视工具

jstat是用于监视虚拟机各种运行状态信息的命令行工具。它可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾回收、JIT编译等运行数,是运行期定位虚拟机性能问题的首选工具。

stat的命令格式：
 
    jstat [option vmid [interval [s|ms] [count]] ]

比如

    jstat -gc 2764 250 20

表示：每250毫米查询一次进程2764的垃圾收集状况，一共查询20次。如果省略后面两个参数，则说明只查询一次。vmid可以通过jps获取到。

示例：

![](http://upload.ouliu.net/i/20171031214541mzki7.png)

### 1.3 jinfo : Java配置信息工具

用来实时查看和调整虚拟机各项参数。

### 1.4 jmap : Java内存映像工具

jmap命令用于生成堆转储快照。jmap的作用并不仅仅为了获取dump文件，它还可以查询finalize执行队列、java堆和永久代的详细信息。如空间使用率、当前用的是哪种收集器等。

jmap格式 

    jmap [option] vmid

### 1.5 jhat：虚拟机堆转储快照分析工具

用来分析dump生成的堆快照，不过功能可以完全被其他工具取代，而且该工具在可视化方面也不好，所以可以略过。

### 1.6 jstack：java堆栈跟踪工具

stack命令用于生成虚拟机当前时刻的线程快照。线程快照就是当前虚拟机内每一条线程正在执行的方法堆栈集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程死锁、死循环、请求外部资源导致长时间等待等。

jstack格式： 

    jstack [option] vmid

参数：

    -F  当正常输出的请求不被响应时，强制输出线程堆栈
    -l  除堆栈外，显示关于锁的附加信息
    -m  如果调用到本地方法的话，可以显示c/c++的堆栈

示例：

![](http://upload.ouliu.net/i/20171031220341wjp50.png)

### 1.7 HSDIS：JIT生成代码反汇编

## 2、JDK的可视化工具

### 2.1 JConsole

在jdk的bin目录下面找到该软件之后打开，非常方便地使用，它的主界面，也即它的主要功能如下：

![](http://upload.ouliu.net/i/2017103122245011hmt.png)

它的主要功能其实也就体现在各个选项卡上面，所以当我们需要实时监控比如线程、内存等信息的时候，我们可以考虑使用它来完成。

### 2.2 VisualVM：多合一故障处理工具

它是位于jdk的bin目录下面的一个名为jvisualvm的可执行文件，打开它之后在左侧双击我们需要监控的进行即可对进行进行监控。

![](http://upload.ouliu.net/i/20171031223228c9ywe.png)

我们可以在“工具-插件”中选择需要安装的插件，而它的页面中的功能选项卡也是基于所安装的插件的。
从“工具-插件”中直接通过检查URL来获取插件已经行不通了，可以到下面的链接：

[https://visualvm.github.io/pluginscenters.html](https://visualvm.github.io/pluginscenters.html)

中下载指定jdk版本的插件，然后在“工具-插件-已下载”中进行安装。