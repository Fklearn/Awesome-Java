## 网络层

网络层的目的是实现两个端系统之间的数据透明传送，具体功能包括寻址和路由选择、连接的建立、保持和终止等。它提供的服务使传输层不需要了解网络中的数据传输和交换技术。主要内容有：虚电路分组交换和数据报分组交换、路由选择算法、阻塞控制方法、X.25协议、综合业务数据网（ISDN）、异步传输模式（ATM）及网际互连原理与实现。

网络层的三个重要组成部分：1).IP协议;2).路由选择部分;3).报告数据报中的差错和信息报告协议.

### 1.转发和路由选择

网络节点在收到一个分组后，要确定向下一节点传送的路径，这就是**路由选择**。路由选择和**转发**的区别：转发是将分组从一个输入链路接口转移到适当的输出链路接口的路由器本地动作；路由选择是指网络范围的过程，以决定分组从源到目的地所采用的端到端的路径。

路由器具有一张**转发表**用于根据达到分组的首部字段的值来转发分组。

### 2.虚电路和数据报网络

网络层使用**虚电路和数据报网络**提供类似于传输层的连接和无连接服务。其中虚电路用于提供连接服务，数据报网络用于提供无连接服务。

**虚电路**通信与电路交换类似，两者都是面向连接的，即数据按照正确的顺序发送，并且在连接建立阶段都需要额外开销。

在**数据报网络**中，当端系统要发送分组时，就为分组加上目的端系统的地址，然后分组推进网络中，无需建立任何虚电路(因为没有虚电路).

1. 相对于数据报网络，虚电路网络更容易保证服务质量。

### 3.路由器工作原理

路由器分成4个部分：输入端口、交换结构、输出端口和路由选择器。

1. 它比较路由表中的信息和数据的目的IP地址，把到来的数据发送到正确的**子网和主机**。

### 4.网际协议

当前正在使用的是IPv4(IP协议版本4)，已经提议使用IPv6. 

#### 1.IP数据报

以下是Ipv4的数据报格式：

![](https://user-gold-cdn.xitu.io/2017/7/20/a871001c14f23a4f1046ab687528f690?imageView2/0/w/1280/h/960)

一个链路层能够承载的最大数据量叫做**最大传送单元(MTU)**。所以当网络层分组超出了MTU限制时，需要对IP数据报进行分片。当到达目的主机时，为了让目的主机执行重新组装任务，IPv4的设计者将标识、标志和片偏移量放在IP数据报首部中，供给目的主机来组装数据报。

1. IP 协议提供的是服务类型是**无连接的数据报服务**;

#### 2.IPv4编址

主机通常通过一条链路连接到网络，当主机中的IP要发送数据报时，就通过该链路发送。主机与物理链路之间的边界叫**接口**。因此，一个IP实际是与一个接口关联的，而不是与包括该接口的主机或者路由器关联的。

每个IP地址长度为**32比特(4字节)**。通过每8比特分成一组，用**点分十进制标记**。这些地址不是自由选择的，而是一部分由其子网来决定。表示形式为：

    ********.********.********.******** (其中*表示1个二进制位，共4组，每组8位二进制数)

写成十进制数就是：X.X.X.X（其中X表示0—255之间的一个十进制数）。

##### 1.子网掩码

子网掩码用来区别网络位和主机位，子网掩码决定**子网数目**和每个子网的**主机数目**。用**1表示网络位**，用**0表示主机位**。比如：

1. A类IP地址的掩码：11111111.00000000.00000000.00000000  写成十进制 255.0.0.0
也可以用/8来表示，表示前8位是网络位，比如：10.3.3.3/8
2. B类IP地址的掩码：11111111.11111111.00000000.00000000  写成十进制 255.255.0.0
也可以用/16来表示，表示前16位是网络位，比如：172.16.7.6/16
3. C类IP地址的掩码：11111111.11111111.11111111.00000000  写成十进制 255.255.255.0
也可以用/24来表示，表示前24位是网络位，比如：192.168.5.8/24

子网掩码为255.255.255.255表示本网段只有1个IP地址，举例：电信运营商动态分配给用户的IP地址110.80.191.243和子网掩码255.255.255.255。

**IP地址的分类**
IP地址分为A类、B类、C类、D类、E类，规定如下：

1. A类：网络位8位，主机位24位，网络前导位为0，即：

        0*******.********.********.********  即1.0.0.0—127.255.255.255
        网络位00000000不可用，网络位01111111(127)表示回送地址，指本地机。

2. B类：网络位16位，主机位16位，网络前导位为10，即：

        10******.********.********.********  即128.0.0.0—191.255.255.255

3. C类：网络位24位，主机位8位，前导位为110，即：

        110*****.********.********.********  即192.0.0.0—223.255.255.255

4. D类：组播地址，前导位为1110，即：

        1110****.********.********.********  即224.0.0.0—239.255.255.255

5. E类：保留地址，前导位为11110，即：

        11110***.********.********.********  即240.0.0.0—247.255.255.255

其中A类、B类、C类IP地址可供普通用户使用。

###### 1.子网掩码的计算

1. 10000000→128  (借1位)
2. 11000000→128＋64＝192  (借2位)
3. 11100000→128＋64＋32＝224  (借3位)
4. 11110000→128＋64＋32＋16＝240  (借4位)
5. 11111000→128＋64＋32＋16＋8＝248  (借5位)
6. 11111100→128＋64＋32＋16＋8＋4＝252  (借6位)
7. 11111110→128＋64＋32＋16＋8＋4＋2＝254  (借7位)
8. 11111111→128＋64＋32＋16＋8＋4＋2＋1＝255  (借8位)

###### 2.举例

1. 举例1：172.17.0.3/19子网掩码是多少 (借3位)
子网掩码11111111.11111111.11100000.00000000 即255.255.224.0
2. 举例2：192.168.6.7/26子网掩码是多少 (借2位)
子网掩码11111111.11111111.11111111.11000000 即255.255.255.192

**因特网控制报文协议ICMP**，被主机和路由器用来彼此沟通网络层的信息，最典型的用途是差错报告。ping程序即通过发送一个ICMP类型8编码0的报文到指定主机实现的。

**IPv6**，将IP地址长度从32比特增加到了128比特。

#### 2.DHCP动态主机配置协议

它能够动态地为接入某个子网的主机提供可用的IP地址。它可以由系统管理员来配置。当然分配IP地址的工作也可以手动完成。

### *相关题目：

**1.某主机的IP 地址为 180.80.77.55，子网掩码为 255.255.252.0。若该主机向其所在子网发送广播分组，则目的地址可以是（ ）。**

由子网掩码255.255.252.0（即11111111.11111111.11111100.00000000）可知网络为连续的1，那么主机位为连续的0，也就是10位，然后题目要发送广播分组，所以求的是广播地址，广播地址的主机位也是全为1，所以主机180.80.77.55所在的广播地址就是 180.80.010011（11.11111111），括号里面的是主机号，主机号全为1就是广播地址，即180.80.79.255

思路：根据子网掩码得到主机位长度，就是从右往左的为0的位数，共10位，然后将原来的IP地址的后10全部置1即得。

**2.对于192.168.0.0到192.168.0.255这个网络来说，以下说法中正确的是____**

1. 网段内可用来作为主机IP的范围是：192.168.0.0到192.168.0.255
2. Network IP是192.168.0.255
3. Broadcast IP是192.168.0.0
4. 网段内的主机可以通过网卡对网卡传递数据
5. 192.168.0.1和192.168.0.2的主机需要使用Router传递数据包
6. 是class B等级

答案：无。可用的主机范围192.168.0.1-192.168.0.254; 网络地址为192.168.0.0; 广播地址192.168.255.255; 因为两主机为同一网段，所以不需要路由器通信; 192在192-224这个范围内所以属于C类地址。

192.168.x.x为私有地址，网段192.168.0.x中最多只能有254（28-2=254）个主机地址。主机地址不可以全部为0或全部为1，全部为0表示对应的网络地址或IP地址不可获知的情况下使用；全部为1作为广播地址。

**3.190.233.27.13./16所在网段地址（ ）**

190.233.0.0,后面的16表示子网掩码是16个1，即255.255.0.0，再和前面地址进行 与，就能得到网段。

**4.IP地址中的网络号有什么作用?**

它指定了主机所属的网络

**5.Reply from 218.30.66.101: bytes=32 time=138ms TTL=247 这是一个 ping 的结果，其中 247 表示什么？**

TTL是  time to live最大生存时间

**6.一个主机的IP层使用IP数据报首部中的_ 域识别应把收到的IP数据报的数据部分交给哪个协议（如ICMP、TCP、UDP）软件。**

A.版本  B.首部长度  C.目的IP地址  D.协议

正确答案: D 

**7.某公司申请到一个C类IP地址，但要连接6个的子公司，最大的一个子公司有26台计算机，每个子公司在一个网段中，则子网掩码应设为（）**

A.255.255.255.192  B.255.255.255.128  C.255.255.255.0  D.255.255.255.224

一个子公司26台机器，2^5 = 32，刚好够用，所以IP地址最后8位里的后5位用作子网内区分的地址。
前3位就是子网掩码了，即11100000，即224。
选D，255.255.255.224


